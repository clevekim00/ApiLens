{
    "schemaVersion": 1,
    "id": "wf-ws-C",
    "name": "C: REST login â†’ WS",
    "startNodeId": "start",
    "env": {
        "loginUrl": "https://echo.websocket.org",
        "wsBase": "wss://echo.websocket.org"
    },
    "nodes": [
        {
            "id": "start",
            "type": "start",
            "name": "Start",
            "position": {
                "x": 80,
                "y": 180
            },
            "inputPorts": [],
            "outputPorts": [
                {
                    "key": "out"
                }
            ],
            "config": {},
            "data": {
                "name": "Start"
            }
        },
        {
            "id": "login",
            "type": "api",
            "name": "Login",
            "position": {
                "x": 320,
                "y": 180
            },
            "inputPorts": [
                {
                    "key": "in"
                }
            ],
            "outputPorts": [
                {
                    "key": "success"
                },
                {
                    "key": "failure"
                }
            ],
            "data": {
                "name": "Login"
            },
            "config": {
                "method": "POST",
                "url": "{{env.loginUrl}}",
                "headers": {
                    "Content-Type": "application/json"
                },
                "body": "{\"id\":\"user\",\"pw\":\"pass\"}"
            }
        },
        {
            "id": "wsConnect",
            "type": "ws_connect",
            "name": "WS Connect (Token)",
            "position": {
                "x": 600,
                "y": 180
            },
            "inputPorts": [
                {
                    "key": "in"
                }
            ],
            "outputPorts": [
                {
                    "key": "success"
                },
                {
                    "key": "failure"
                }
            ],
            "data": {
                "name": "WS Connect (Token)"
            },
            "config": {
                "mode": "direct",
                "url": "{{env.wsBase}}?token={{node.login.response.body}}",
                "storeAs": "mainWs"
            }
        },
        {
            "id": "wsSend",
            "type": "ws_send",
            "name": "Send ping",
            "position": {
                "x": 880,
                "y": 180
            },
            "inputPorts": [
                {
                    "key": "in"
                }
            ],
            "outputPorts": [
                {
                    "key": "success"
                },
                {
                    "key": "failure"
                }
            ],
            "data": {
                "name": "Send ping"
            },
            "config": {
                "sessionKey": "mainWs",
                "payloadFormat": "json",
                "payload": "{\"type\":\"ping\"}"
            }
        },
        {
            "id": "wsWait",
            "type": "ws_wait",
            "name": "Wait pong",
            "position": {
                "x": 1160,
                "y": 180
            },
            "inputPorts": [
                {
                    "key": "in"
                }
            ],
            "outputPorts": [
                {
                    "key": "success"
                },
                {
                    "key": "failure"
                }
            ],
            "data": {
                "name": "Wait pong"
            },
            "config": {
                "sessionKey": "mainWs",
                "timeoutMs": 5000,
                "match": {
                    "type": "jsonPathEquals",
                    "value": "$.type==\"pong\""
                }
            }
        },
        {
            "id": "endOk",
            "type": "end",
            "name": "End OK",
            "position": {
                "x": 1440,
                "y": 140
            },
            "inputPorts": [
                {
                    "key": "in"
                }
            ],
            "outputPorts": [],
            "config": {},
            "data": {
                "name": "End OK"
            }
        },
        {
            "id": "endFail",
            "type": "end",
            "name": "End FAIL",
            "position": {
                "x": 600,
                "y": 320
            },
            "inputPorts": [
                {
                    "key": "in"
                }
            ],
            "outputPorts": [],
            "config": {},
            "data": {
                "name": "End FAIL"
            }
        }
    ],
    "edges": [
        {
            "id": "e1",
            "sourceNodeId": "start",
            "sourcePort": "out",
            "targetNodeId": "login",
            "targetPort": "in"
        },
        {
            "id": "e2",
            "sourceNodeId": "login",
            "sourcePort": "success",
            "targetNodeId": "wsConnect",
            "targetPort": "in"
        },
        {
            "id": "e3",
            "sourceNodeId": "wsConnect",
            "sourcePort": "success",
            "targetNodeId": "wsSend",
            "targetPort": "in"
        },
        {
            "id": "e4",
            "sourceNodeId": "wsSend",
            "sourcePort": "success",
            "targetNodeId": "wsWait",
            "targetPort": "in"
        },
        {
            "id": "e5",
            "sourceNodeId": "wsWait",
            "sourcePort": "success",
            "targetNodeId": "endOk",
            "targetPort": "in"
        },
        {
            "id": "e6",
            "sourceNodeId": "login",
            "sourcePort": "failure",
            "targetNodeId": "endFail",
            "targetPort": "in"
        },
        {
            "id": "e7",
            "sourceNodeId": "wsConnect",
            "sourcePort": "failure",
            "targetNodeId": "endFail",
            "targetPort": "in"
        },
        {
            "id": "e8",
            "sourceNodeId": "wsSend",
            "sourcePort": "failure",
            "targetNodeId": "endFail",
            "targetPort": "in"
        },
        {
            "id": "e9",
            "sourceNodeId": "wsWait",
            "sourcePort": "failure",
            "targetNodeId": "endFail",
            "targetPort": "in"
        }
    ]
}